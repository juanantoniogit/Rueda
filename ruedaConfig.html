<html><head><title></title>
<link rel=stylesheet href="rueda.css"></link>

<style>
.buttonHorasE{  
    height:17px;
    width:17px;
font-size:9px;

}
.nosale{  
    height:17px;
    width:17px;
font-size:9px;
background-color:#bb9;
}
.buttonHorasS{  height:17px;
    width:17px;font-size:9px;}
.verde{ background-color:#9fa;}
.rosa{ background-color:#f9f;}
.blanco{ background-color:#fff;}
</style>
<script
			  src="https://code.jquery.com/jquery-3.3.1.min.js"
			  integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
			  crossorigin="anonymous">
</script>

<script src="datos.js"></script>

</head>
<body>
<div class="fixed" id="info"></div>
<div id="titulo">
	CONFIGURAR RUEDA    
	<table border="0" style="border-width:0px;border-style:solid;" width="95%"><tr>
	<td width="20%" style="text-align:right;border-width:0px;border-style:solid;" valign="middle"><h2><pre><button id="userMenos"><</button>  <button id="userMas">></button><span>   NOMBRE USUARIO </span></h2></pre></td>
	<td width="10%" style="text-align:left;border-width:0px;border-style:solid;" valign="middle"><input type="text" id="nombre" readonly style="margin-left:30px;padding:8px;font-size:20px;font-weight:700;"></td>
	<td width="70%" style="text-align:left;width:90%;border-width:0px;border-style:solid;" ><div id="nombresUsuarios"></div></td>
	</tr></table>
 <script>
   </script>
</div>
<table class="data-table" cellpadding="4px" cellpadding="4px" width="95%">
  <tr>
    <th class="hora"></th>
    <th>Lunes&nbsp;&nbsp;&nbsp;<button class="nosale" id="nosale_1">x</button></th>
    <th>Martes&nbsp;&nbsp;&nbsp;<button class="nosale" id="nosale_2">x</button></th>
    <th>Mi&eacute;rcoles&nbsp;&nbsp;&nbsp;<button class="nosale" id="nosale_3">x</button></th>
    <th>Jueves&nbsp;&nbsp;&nbsp;<button class="nosale" id="nosale_4">x</button></th>
    <th>Viernes&nbsp;&nbsp;&nbsp;<button class="nosale" id="nosale_5">x</button></th>
  </tr>
  <tr>
    <td class="hora">ENTRA a</td>
    <td id="1E"></td>
    <td id="2E"></td>
    <td id="3E"></td>
    <td id="4E"></td>
    <td id="5E"></td>
  </tr>
   <tr>
    <td class="hora">SALE a</td>
    <td id="1S"></td>
    <td id="2S"></td>
    <td id="3S"></td>
    <td id="4S"></td>
    <td id="5S"></td>
  </tr>
</table>


<div style="white-space: pre;">

<span ><button id="borrarUsuario">BORRAR USUARIO</button></span>                                         <span ><button id="insertarUsuario">INSERTAR USUARIO</button></span>

</div>

<textarea id="codigo" style="width:97%">

</textarea>
 <div class="fixed"></div>
 
 <script>
var nDiasSemena=5
var nHorasEntrada=7
var nHorasSalida=7
 var diass = ['', 'l', 'm', 'x', 'j', 'v']
var diasn = ['', 'lunes', 'martes', 'miercoles', 'jueves', 'viernes']
var nombreUsuario=''
var contUsuarios=0;


function limpiaEntrada(dia, hora){
	var el;
	for(var horasEntrada=1; horasEntrada <=nHorasEntrada; horasEntrada++){
		el=$('#hE'+dia+'_'+horasEntrada)
		if (el.hasClass("verde")) {
			el.addClass('blanco');
			el.removeClass('verde');
			break
		} 			
	}
	if(hora>0){
		el=$('#hE'+dia+'_'+hora)
		el.addClass('verde');
		el.removeClass('blanco');
	}
}

function limpiaSalida(dia, hora){
	var el;
	for(var horasEntrada=1; horasEntrada <=nHorasEntrada; horasEntrada++){
		el=$('#hS'+dia+'_'+horasEntrada)
		if (el.hasClass("rosa")) {
			el.addClass('blanco');
			el.removeClass('rosa');
			break
		} 			
	}	
	if(hora>0){
		el=$('#hS'+dia+'_'+hora)
		el.addClass('rosa');
		el.removeClass('blanco');
	}
}

function botonSensor(){
	$('.buttonHorasE').click(function(){

	   if( usuario.length>0){
			var s1=this.id.substring(2)
			var s2=s1.split('_')
			limpiaEntrada(s2[0],s2[1])
			
			var entrada=usuario[contUsuarios][diasn[s2[0]]].entrada
			//$('#'+diass[s2[0]]+entrada+'chte').html(' ')
			//$('#'+diass[s2[0]]+s2[1]+'chte').html(nombreUsuario)
			usuario[contUsuarios][diasn[s2[0]]].entrada=s2[1]
			escribirCodigo()
		}
	})
	$('.buttonHorasS').click(function(){
		if( usuario.length>0){
			var s1=this.id.substring(2)
			var s2=s1.split('_')
			limpiaSalida(s2[0],s2[1])
			
			var salida=usuario[contUsuarios][diasn[s2[0]]].salida
			//$('#'+diass[s2[0]]+salida+'chts').html(' ')
			//$('#'+diass[s2[0]]+s2[1]+'chts').html(nombreUsuario)
			usuario[contUsuarios][diasn[s2[0]]].salida=s2[1]
			escribirCodigo()
		}
	})
}

function rellenaBotones(n){
	if(n<0){
		var cad='';
		for(var diasSemana=1; diasSemana <=nDiasSemena; diasSemana++){
			cad=''
			for(var horasEntrada=1; horasEntrada <=nHorasEntrada; horasEntrada++){
				cad+='<button class="buttonHorasE" id="hE'+horasEntrada+'_'+diasSemana+'">'+horasEntrada+'</button>'
			}
			$('#'+diasSemana+'E').html(cad)
			 cad=''
			for(var horasSalida=1; horasSalida <=nHorasSalida; horasSalida++){
				cad+='<button class="buttonHorasS" id="hS'+horasSalida+'_'+diasSemana+'">'+horasSalida+'</button>'
			}
			$('#'+diasSemana+'S').html(cad)
			
		}
	}else{
		var cad='',cad1='';cad2='';
		 var entrada=0, salida=0;
		var buttColorClase=''
		nombreUsuario=usuario[n].nombre
		$('#nombre').val(nombreUsuario)
		//alert(nombreUsuario)
		for(var diasSemana=1; diasSemana <=nDiasSemena; diasSemana++){
			//ENTRADAS
			cad=''
			$('#'+diasSemana+'E').html('')
			for(var horasEntrada=1; horasEntrada <=nHorasEntrada; horasEntrada++){
				
				cad1='<button class="buttonHorasE' 
				cad2='" id="hE'+diasSemana+'_'+horasEntrada+'">'+horasEntrada+'</button>'
				entrada=usuario[n][diasn[diasSemana]].entrada
				if(entrada==horasEntrada){
					cad1+=' verde'
					//$('#'+diass[diasSemana]+horasEntrada+'chte').html(nombreUsuario)
				}else{cad1+=' blanco'}
				$('#'+diasSemana+'E').append(cad1+cad2)
			}
			//SALIDAS
			
			$('#'+diasSemana+'S').html('')
			for(var horasSalida=1; horasSalida <=nHorasSalida; horasSalida++){
				cad1='<button class="buttonHorasS' 
				cad2='" id="hS'+diasSemana+'_'+horasSalida+'">'+horasSalida+'</button>'
				//cad='<button class="buttonHorasS" id="hS'+horasSalida+'_'+diasSemana+'">'+horasSalida+'</button>'
				salida=usuario[n][diasn[diasSemana]].salida
				if(salida==horasSalida){
					cad1+=' rosa'
					//$('#'+diass[diasSemana]+horasSalida+'chts').html(nombreUsuario)
					
				}else{cad1+=' blanco'}
				$('#'+diasSemana+'S').append(cad1+cad2)
			}

			
		}
		
	}	
	
	botonSensor()
}

function rellenaNombres(){
	var cad='';
	for(var a=0;a<usuario.length;a++){
		cad+='<button id="u_'+a+'" onclick="contUsuarios='+a+';rellenaBotones('+a+')">'+usuario[a].nombre+'</button>'
	}
	$('#nombresUsuarios').html(cad)
}

function escribirCodigo(){
	//$('#codigo').val(usuario.toSource())
	$('#codigo').val('var usuario='+JSON.stringify(usuario))
}

$(document).ready(function(){
	escribirCodigo()
	rellenaBotones(contUsuarios)
	rellenaNombres()
	//////
	 $('#borrarUsuario').click(function(){
	 var c=0;
	 if(contUsuarios==usuario.length-1){c=1}
	
	    usuario.splice(contUsuarios,1)
		 if(usuario.length==0){nombreUsuario=''; $('#nombre').val(' ')}
		if(c==1){contUsuarios--}
		escribirCodigo()
		rellenaBotones(contUsuarios)
		rellenaNombres()
	 }) 
	  $('#insertarUsuario').click(function(){
	  var n=prompt('Nombre del usuario')
		usuario.push({
		  nombre: n,
		  lunes: {
			entrada: 0,
			salida: 9,
			usacoche: false
		  },
		  martes: {
			entrada: 0,
			salida: 0,
			usacoche: false
		  },
		  miercoles: {
			entrada: 0,
			salida: 0,
			usacoche: false
		  },
		  jueves: {
			entrada: 0,
			salida: 0,
			usacoche: false
		  },
		  viernes: {
			entrada: 0,
			salida: 0,
			usacoche: false
		  }
		})
		escribirCodigo()
		contUsuarios=usuario.length-1
		rellenaBotones(contUsuarios)
		rellenaNombres()
	 }) 
	
		$('.nosale').click(function(){
		  var s= this.id.split('_')
		  usuario[contUsuarios][diasn[s[1]]].salida=0;
		  usuario[contUsuarios][diasn[s[1]]].entrada=0;
		  limpiaEntrada(s[1],0)
		  limpiaSalida(s[1],0)
		  escribirCodigo()
		}) 
	
		$('#userMas').click(function(){
		   contUsuarios++
		   if(contUsuarios>=usuario.length){contUsuarios=usuario.length-1}
		   rellenaBotones(contUsuarios)
		}) 
		$('#userMenos').click(function(){
		   contUsuarios--
		   if(contUsuarios<0){contUsuarios=0}
		   rellenaBotones(contUsuarios)
		}) 
})


 </script>
</body>
</html>
